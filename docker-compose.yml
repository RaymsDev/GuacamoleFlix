version: "3"
services:
    reverse-proxy:
      image: nginx:latest
      container_name: reverse-proxy
      volumes:
        - ./nginx.conf:/etc/nginx/nginx.conf
      ports:
        - 80:80
        - 443:443
      depends_on:
        - back
        - front
      networks:
        proxy-network:
    front:
      restart: always
      container_name : front
      build: 
        context: .
        dockerfile: ./Dockerfile-client
      expose:
       - "4201"
      networks:
        proxy-network:
    back:
      restart: always
      build: 
        context: .
        dockerfile: ./Dockerfile-server
      container_name: back
      expose:
        - "3000"
      depends_on:
        - mongo
      environment:
        - DB_NAME=guacamoleflix
        - MONGODB_URI=mongodb://mongo:27017/guacamoleflix
        - MONGODB_USER=mongo_admin
        - MONGODB_PASS=MyStrongPassword
        - SERVER_PORT=3000
        - ENV=production
      networks:
        proxy-network:
    mongo:
      image: mongo
      container_name: mongo
      volumes:
        - mongo-data:/data/db
      ports:
        - "27017:27017"
      environment:
        - MONGO_INITDB_DATABASE=guacamoleflix
        - MONGO_INITDB_ROOT_USERNAME=mongo_admin
        - MONGO_INITDB_ROOT_PASSWORD=MyStrongPassword
      networks:
        proxy-network:
volumes:
  mongo-data:
networks:
  proxy-network: